<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Managetender | eazyProcure</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --sidebar-width: 260px;
      --navbar-height: 64px;
      --accent: #0d6efd;
      --muted: #6c757d;
    }

    html,body { height: 100%; margin: 0; font-family: "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial; background: #f8f9fa; }

    /* NAVBAR (light green) */
    .topbar {
      height: var(--navbar-height);
      background: #bfe8b9; /* light green */
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      position: fixed;
      left: var(--sidebar-width);
      right: 0;
      top: 0;
      z-index: 1100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: left .25s ease;
    }

    .nav-actions { display: flex; align-items: center; gap: 15px; }
    .nav-icon { cursor: pointer; font-size: 1.2rem; position: relative; }
    .icon-badge::after { content: attr(data-count); position: absolute; top: -6px; right: -8px; background: red; color: white; font-size: 0.7rem; padding: 2px 5px; border-radius: 50%; display: none; }
    .icon-badge[data-count]:not([data-count="0"])::after { display: inline-block; }
    .brand { font-weight: 700; color: #134611; }

    .nav-actions { display: flex; align-items: center; gap: 10px; }
    .nav-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      margin-left: 8px;
      border-radius: 8px;
      cursor: pointer;
      color: #13340f;
      transition: background .2s, transform .12s;
    }
    .nav-icon:hover { background: rgba(0,0,0,0.06); transform: translateY(-1px); }
    .nav-icon .bi { font-size: 1.15rem; }

    .icon-badge { position: relative; }
    .icon-badge .badge { position: absolute; top: -6px; right: -6px; font-size: 0.6rem; }

    /* layout: sidebar + content */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar (light) */
    .sidebar {
      width: var(--sidebar-width);
      background: #f1f5f2;
      padding: 18px 12px;
      padding-top: calc(var(--navbar-height) + 14px); /* start under navbar */
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      overflow-y: auto;
      box-shadow: 2px 0 6px rgba(0,0,0,0.04);
      transition: transform .28s ease;
      z-index: 1050;
    }
    .sidebar.visible { transform: translateX(0); }
    .sidebar.collapsed { transform: translateX(-110%); }

    .sidebar .nav-section { margin-bottom: 6px; }
    .sidebar .nav-link {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 9px 10px;
      color: #213426;
      border-radius: 8px;
      text-decoration: none;
      margin-bottom: 4px;
      transition: background .18s;
    }
    .sidebar .nav-link:hover { background: #e6f0e6; color: #0d6efd; }

    .sidebar .nav-left { display: flex; gap: 10px; align-items: center; }
    .sidebar .nav-left .bi { font-size: 1.05rem; color: var(--accent); }

    /* submenu slide (animated) */
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height .32s ease, padding .2s ease;
      padding-left: 36px;
    }
    .submenu.show {
      max-height: 420px; /* enough room */
      padding-top: 8px;
      padding-bottom: 8px;
    }
    .submenu a {
      display:block;
      padding:8px 12px;
      text-decoration:none;
      color:#183f28;
      border-radius:6px;
      margin-bottom:4px;
    }
    .submenu a:hover { background:#e6f0e6; color:var(--accent); }

    /* main content area */
    .content {
      margin-left: var(--sidebar-width);
      margin-top: var(--navbar-height);
      padding: 22px;
      flex: 1;
      transition: margin-left .28s ease;
    }
    .sidebar.collapsed ~ .content {
      margin-left: 0;
    }
    .sidebar.collapsed ~ .topbar { left: 0; }

    .cards-top { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; margin-bottom: 18px; }
    .cards-bottom { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; margin-bottom: 20px; }

    .stat-card {
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      display:flex;
      align-items:center;
      gap: 12px;
      cursor:pointer;
      transition: transform .16s ease, box-shadow .16s;
      color: white;
    }
    .stat-card:hover { transform: translateY(-6px); box-shadow: 0 12px 28px rgba(0,0,0,0.06); }
    .stat-icon { width:56px;height:56px;border-radius:10px; display:flex;align-items:center;justify-content:center;font-size:1.6rem;color:white; flex-shrink:0; }
    .stat-body { flex:1; }
    .stat-title { font-size:0.85rem;color:var(--muted); margin:0; }
    .stat-value { font-size:1.55rem;font-weight:700;margin:4px 0 0;color:#222; }

    .c-admin{background: linear-gradient(135deg,#3b82f6,#2563eb);}  .c-client{background: linear-gradient(135deg,#10b981,#059669);} .c-supplier{background: linear-gradient(135deg,#fb923c,#f97316);} .c-open{background: linear-gradient(135deg,#06b6d4,#0891b2);} .c-closed{background: linear-gradient(135deg,#94a3b8,#6b7280);} .c-applied{background: linear-gradient(135deg,#f59e0b,#d97706);} .c-approved{background: linear-gradient(135deg,#7c3aed,#6d28d9); }

    /* Open tenders table */
    .table-card { margin-top: 8px; background: white; padding: 14px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.03); }

    /* popups anchored to icons */
    .floating-popup {
      position: absolute;
      width: 260px;
      max-width: 40vw;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      padding: 10px;
      z-index: 1200;
      display: none;
    }
    .floating-popup .item { display:flex; gap:10px; align-items:center; padding:8px 6px; border-bottom:1px solid #f0f0f0; }
    .floating-popup .item:last-child{border-bottom:none;}
    .floating-popup .item .bi { font-size:1.05rem; color:var(--accent); width:28px; text-align:center; }
    .floating-popup h6{margin:0 0 8px 0;font-size:0.95rem;color:var(--accent);}

    /* Responsive */
    @media (max-width: 991px) {
      .cards-top { grid-template-columns: repeat(2,1fr); }
      .cards-bottom { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width: 768px) {
      .topbar { left: 0; padding: 0 10px; }
      .sidebar { transform: translateX(-110%); position: fixed; z-index:1300; }
      .sidebar.visible { transform: translateX(0); }
      .content { margin-left: 0; padding: 14px; margin-top: var(--navbar-height); }
      .cards-top { grid-template-columns: 1fr; }
      .cards-bottom { grid-template-columns: repeat(2,1fr); }
    }

    /* --- Top Navbar Styling (extra) --- */
    .navbar-custom { margin-left: 260px; background: #90ee90; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
    .navbar-custom .left span { font-size: 1.3rem; font-weight: bold; color: #1e1e2f; }
    .navbar-custom .right { display: flex; align-items: center; gap: 25px; }
    .icon-wrapper { position: relative; cursor: pointer; }
    .icon-wrapper i { font-size: 1.4rem; color: #1e1e2f; }
    .icon-wrapper .badge { position: absolute; top: -5px; right: -10px; background: red; color: #fff; font-size: 0.7rem; border-radius: 50%; padding: 3px 6px; }

    .navbar-custom .dropdown-menu { min-width: 250px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 8px; border: none; }
    .navbar-custom .dropdown-menu .dropdown-item { font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
    .navbar-custom .dropdown-menu .dropdown-item i { font-size: 1rem; color: #0d6efd; }
    .navbar-custom .dropdown-menu .dropdown-item.text-danger { color: #dc3545 !important; }
    .navbar-custom .dropdown-menu .dropdown-item.text-danger:hover { background: #f8d7da; color: #a71d2a !important; }

    /* small utility */
    .muted-small{color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
  <div class="layout">
    <!-- Sidebar (light) -->
   <%- include('partials/sidebar') %>

    <!-- Top Navbar (light green) -->
     <%- include('partials/topbar') %>

    <!-- MAIN CONTENT -->
    <main class="content">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h3 class="mb-0" style="color:#008000;">Manage tender</h3>
          <small class="muted-small" style="color:#008000;">Create, manage and QA</small>
        </div>

        <div class="d-flex gap-2 align-items-center">
          <input id="searchInput" class="form-control form-control-sm" placeholder="Search code, title..." style="width:260px">
          <select id="statusFilter" class="form-select form-select-sm" style="width:160px">
            <option value="">All Status</option>
            <option>Draft</option>
            <option>open</option>
            <option>Closed</option>
          </select>
          <!-- Button to Open Modal -->
<button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createJobModal">
  <i class="bi bi-plus-lg"></i> New Job
</button>

<!-- Create Job Modal -->
<div class="modal fade" id="createJobModal" tabindex="-1" aria-labelledby="createJobModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="createJobModalLabel">Create New Job</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form action="/create_job" method="post" id="createJobForm">
          
          <div class="mb-3">
            <label class="form-label">Client</label>
            <select name="client" class="form-select" required>
              <option value="">Select Client</option>
              <option value="County Government">County Government</option>
              <option value="Ministry">Ministry</option>
              <option value="Private Company">Private Company</option>
              <option value="NGO">NGO</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Bid Title</label>
            <input type="text" name="bid_title" class="form-control" placeholder="Enter bid title" required>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Start Date & Time</label>
              <input type="datetime-local" name="start_datetime" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Closing Date & Time</label>
              <input type="datetime-local" name="closing_datetime" class="form-control" required>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Eligibility Criteria</label>
            <select name="eligibility" class="form-select" required>
              <option value="">Select Eligibility</option>
              <option value="All">All</option>
              <option value="Youth">Youth</option>
              <option value="Women">Women</option>
              <option value="PWDs">PWDs</option>
            </select>
          </div>

          <div class="text-end">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Create Job</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createRfxModal">
            <i class="bi bi-plus-lg"></i> Createtender
          </button>
        </div>
      </div>

      <div class="table-card">
        <div class="table-responsive">
          <table class="table table-striped align-middle" id="rfxTable">
            <thead >
              <tr>
                   <!-- <th>Company</th>
      <th>BidTitle</th>
      <th>Closing date</th>
       <th>Eligibility</th>
      <th>Action</th> -->
         

                <th style="color:#008000;">Company</th>
                <th style="color:#008000;">BidTitle</th>
                <th style="color:#008000;">Closing Date</th>
                  <th style="color:#008000;">Eligibility</th>
              
             
                <th class="text-end" style="color:#008000;" colspan="3">Action</th>
              </tr>
            </thead>
            <tbody>
      
<tbody>
  <% if (tenders && tenders.length > 0) { %>
    <% tenders.forEach(tender => { %>
      <tr>
           <td>
            <img src="<%= tender.logo || '/images/default-logo.png' %>" 
                 alt="Logo" width="40" height="40" class="rounded-circle">
          </td>
        <!-- <td><%= tender.code %></td> -->
        <td><%= tender.title %></td>
       
       <td>
  <% if (tender.closing_date) { %>
    <%= new Date(tender.closing_date).toLocaleString('en-KE', { 
          dateStyle: 'medium', 
          timeStyle: 'short' 
        }) %>
  <% } else { %>
    N/A
  <% } %>
</td>
<td><span class="badge bg-secondary">View</span></td>
       <!-- <td>
  <span class="badge 
    <% if (tender.status === 'open') { %> bg-success 
    <% } else if (tender.status === 'Draft') { %> bg-warning text-dark 
    <% } else if (tender.status === 'closed') { %> bg-danger 
    <% } else { %> bg-secondary <% } %>">
    <%= tender.status %>
  </span>
</td> -->

        <td class="text-end">
          <button class="btn btn-sm btn-outline-secondary me-1" onclick="openViewModal(this)"><i class="bi bi-eye"></i> View</button>
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="openEditModal(this)"><i class="bi bi-pencil-square"></i> Edit</button>
                  <!-- <button class="btn btn-sm btn-outline-success me-1" onclick="openQaModal(this)"><i class="bi bi-check2-square"></i> QA</button> -->
                  <a href="/deltend:id?=<%tender.code%>"><button class="btn btn-sm btn-outline-danger" onclick="deleteRfx(this)"><i class="bi bi-trash"></i></button></a>
        </td>
      </tr>
    <% }) %>
  <% } else { %>
    <tr>
      <td colspan="6" class="text-center text-muted">No  Jobs found</td>
    </tr>
  <% } %>
</tbody>

           

            </tbody>
          </table>
        </div>
      </div>

      <!-- QA area (summary or quick checks) -->
      <div class="mt-4">
        <h5 style="color:#008000;">QA Notes / Summary</h5>
        <p class="text-muted" style="color:#008000;">Quick QA summary or bulk QA actions will appear here.</p>
      </div>
    </main>
  </div>

  <!-- CREATE Modal -->
<div class="modal fade" id="createRfxModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <form action="/create_tender" method="POST" id="createForm" >
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Create Tender</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
               <div class="col-md-12">
              <label class="form-label">Select Category</label> <br>
             <select class="col-md-4" name="category" id="" style="height: 40%;">
                <% if(category && category.length > 0){ %>
                       <% category.forEach(categ =>{ %>
                        <option value="<%=categ.category_name %>"><%=categ.category_name %></option>
                       <% }) %>
              
               <% }else{ %>
  <option > No categories found</option>
              <% } %>
             </select>
             <label for="">Select Job</label>
             <select class="col-md-4" name="" id="">
              <option value=""></option>
             </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Code</label>
              <input name="code" class="form-control" placeholder="RFx-YYYY-XXX" required>
            </div>
            <div class="col-md-8">
              <label class="form-label">Title</label>
              <input name="title" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Type</label>
              <select name="type" class="form-select">
                <option>Goods</option>
                <option>Works</option>
                <option>Services</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Closing Date</label>
              <input  name="closingDate" class="form-control" type="datetime-local" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Status</label>
              <select name="status" class="form-select">
                <option>Draft</option>
                <option>Open</option>
                <option>Closed</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea name="description" class="form-control" rows="3"></textarea>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Create Tender</button>
        </div>
      </form>

    </div>
  </div>
</div>
  <!-- VIEW Modal -->
  <div class="modal fade" id="viewRfxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Viewtender</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <dl class="row">
            <dt class="col-sm-3">Code</dt><dd class="col-sm-9" id="v-code"></dd>
            <dt class="col-sm-3">Title</dt><dd class="col-sm-9" id="v-title"></dd>
            <dt class="col-sm-3">Type</dt><dd class="col-sm-9" id="v-type"></dd>
            <dt class="col-sm-3">Closing</dt><dd class="col-sm-9" id="v-closing"></dd>
            <dt class="col-sm-3">Status</dt><dd class="col-sm-9" id="v-status"></dd>
            <dt class="col-sm-3">Created By</dt><dd class="col-sm-9" id="v-created"></dd>
            <dt class="col-sm-3">Description</dt><dd class="col-sm-9" id="v-desc"></dd>
          </dl>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" data-bs-dismiss="modal"> <a href="#">more</a> </button>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- EDIT Modal -->
  <div class="modal fade" id="editRfxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form id="editForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edittender</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="rowId" id="edit-rowId">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Code</label>
              <input id="edit-code" name="code" class="form-control" required>
            </div>
            <div class="col-md-8">
              <label class="form-label">Title</label>
              <input id="edit-title" name="title" class="form-control" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Type</label>
              <select id="edit-type" name="type" class="form-select">
                <option>Goods</option><option>Works</option><option>Services</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Closing Date</label>
              <input id="edit-closing" name="closingDate" class="form-control" type="date" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Status</label>
              <select id="edit-status" name="status" class="form-select">
                <option>Draft</option><option>open</option><option>Closed</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea id="edit-desc" name="description" class="form-control" rows="3"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- QA Modal -->
  <div class="modal fade" id="qaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form id="qaForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">QA Checklist</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="qa-rowId">
          <h6 id="qa-title"></h6>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="qaScope">
            <label class="form-check-label" for="qaScope">Scope is clear and measurable</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="qaCriteria">
            <label class="form-check-label" for="qaCriteria">Evaluation criteria defined</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="qaBudget">
            <label class="form-check-label" for="qaBudget">Budget/estimate attached</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="qaDocs">
            <label class="form-check-label" for="qaDocs">Documents attached & accessible</label>
          </div>
          <div class="mt-3">
            <label class="form-label">Notes</label>
            <textarea id="qaNotes" class="form-control" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-warning" onclick="submitQa('request')">Request Changes</button>
          <button type="button" class="btn btn-success" onclick="submitQa('approve')">Approve & Publish</button>
        </div>
      </form>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // --- Submenu toggle ---
  document.querySelectorAll('[data-toggle="submenu"]').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const targetId = link.getAttribute('data-target');
      const el = document.getElementById(targetId);
      if (el) el.classList.toggle('show');
    });
  });

  // --- Mobile Sidebar toggle ---
  const hamburger = document.getElementById('hamburgerBtn');
  const sidebar = document.getElementById('sidebar');
  if (hamburger && sidebar) {
    hamburger.addEventListener('click', () => sidebar.classList.toggle('visible'));
  }

  // --- View Tender Modal ---
  function openViewModal(btn) {
    const row = btn.closest('tr');
    if (!row) return;

    const cells = row.querySelectorAll('td');
    document.getElementById('v-code').textContent = cells[0].textContent.trim();
    document.getElementById('v-title').textContent = cells[1].textContent.trim();
    document.getElementById('v-type').textContent = cells[2].textContent.trim();
    document.getElementById('v-closing').textContent = cells[3].textContent.trim();
    document.getElementById('v-status').textContent = cells[4].textContent.trim();
    document.getElementById('v-created').textContent = 'System Admin'; // replace with actual creator if available
    document.getElementById('v-desc').textContent = 'N/A'; // optional description if available

    const viewModal = new bootstrap.Modal(document.getElementById('viewRfxModal'));
    viewModal.show();
  }

  // --- Edit Tender Modal ---
  function openEditModal(btn) {
    const row = btn.closest('tr');
    if (!row) return;
    const cells = row.querySelectorAll('td');

    document.getElementById('edit-code').value = cells[0].textContent.trim();
    document.getElementById('edit-title').value = cells[1].textContent.trim();
    document.getElementById('edit-type').value = cells[2].textContent.trim();
    document.getElementById('edit-closing').value = formatToDate(cells[3].textContent.trim());
    document.getElementById('edit-status').value = cells[4].textContent.trim();

    const editModal = new bootstrap.Modal(document.getElementById('editRfxModal'));
    editModal.show();
  }

  // --- QA Modal ---
  function openQaModal(btn) {
    const row = btn.closest('tr');
    if (!row) return;
    const title = row.querySelector('td:nth-child(2)').textContent.trim();
    document.getElementById('qa-title').textContent = title;

    const qaModal = new bootstrap.Modal(document.getElementById('qaModal'));
    qaModal.show();
  }

  // --- Utility: format date (handles locale string to YYYY-MM-DD) ---
  function formatToDate(dateString) {
    const date = new Date(dateString);
    if (isNaN(date)) return '';
    return date.toISOString().split('T')[0];
  }

  // --- Submit QA (approve / request changes) ---
  function submitQa(action) {
    const title = document.getElementById('qa-title').textContent;
    const notes = document.getElementById('qaNotes').value;
    alert(`QA Action: ${action.toUpperCase()} for "${title}"\nNotes: ${notes}`);
    bootstrap.Modal.getInstance(document.getElementById('qaModal')).hide();
  }

  // --- Delete Confirmation ---
  function deleteRfx(btn) {
    const row = btn.closest('tr');
    const code = row.querySelector('td:first-child').textContent.trim();
    if (confirm(`Are you sure you want to delete tender "${code}"?`)) {
      row.remove(); // Replace with actual fetch(`/delete_tender/${code}`, {method:'DELETE'})
    }
  }
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const searchInput = document.getElementById("searchInput");
    const statusFilter = document.getElementById("statusFilter");
    const tableRows = document.querySelectorAll("tbody tr");

    function filterTenders() {
      const searchValue = searchInput.value.toLowerCase().trim();
      const selectedStatus = statusFilter.value.toLowerCase();

      tableRows.forEach(row => {
        const code = row.querySelector("td:nth-child(1)")?.textContent.toLowerCase() || "";
        const title = row.querySelector("td:nth-child(2)")?.textContent.toLowerCase() || "";
        const status = row.querySelector("td:nth-child(5)")?.textContent.toLowerCase() || "";

        const matchesSearch = code.includes(searchValue) || title.includes(searchValue);
        const matchesStatus = !selectedStatus || status === selectedStatus;

        if (matchesSearch && matchesStatus) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    }

    // Attach events
    searchInput.addEventListener("keyup", filterTenders);
    statusFilter.addEventListener("change", filterTenders);
  });
</script>


</body>
</html>
